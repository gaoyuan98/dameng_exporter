# DAMENG_EXPORTER 操作手册

> **⚠️ 注意：本手册仍在持续完善中**  
> 当前版本为初步版本，部分内容可能存在以下情况：
> - 某些高级功能章节尚未完全覆盖
> - 部分示例代码待进一步验证和优化
> - 故障排查案例正在收集和补充中
> - 如有疑问或建议，请提交Issue到GitHub仓库

> 版本：v1.2.0 | 更新日期：2025-09-03 | 作者：DAMENG_EXPORTER Team

## 目录
- [1. 概述](#1-概述)
- [2. 快速开始](#2-快速开始)
- [3. 配置详解](#3-配置详解)
- [4. 最佳实践](#4-最佳实践)
- [5. 运维指南](#5-运维指南)
- [6. 故障排查](#6-故障排查)
- [7. 高级功能](#7-高级功能)
- [8. 监控集成](#8-监控集成)
- [9. 安全加固](#9-安全加固)
- [附录A：命令行参数完整列表](#附录a命令行参数完整列表)
- [附录B：配置文件参数完整列表](#附录b配置文件参数完整列表)
- [附录C：监控指标说明](#附录c监控指标说明)
- [附录D：错误代码说明](#附录d错误代码说明)

---

## 1. 概述

### 1.1 简介
DAMENG_EXPORTER 是达梦数据库的 Prometheus 监控导出器，支持多数据源监控、密码加密、自定义指标等功能。

### 1.2 版本变更
**v1.2.0 重要变更：**
- ⚠️ **移除了命令行参数的默认值**（之前默认 127.0.0.1:5236/SYSDBA/SYSDBA）
- ✅ 支持多数据源监控
- ✅ 优化了配置文件和命令行参数的优先级逻辑
- ✅ 增强了密码加密功能

### 1.3 核心特性
- 支持命令行参数和配置文件两种配置方式
- 支持多数据源并行监控
- 内置密码加密功能
- 支持自定义监控指标
- 提供慢SQL监控
- 支持 Basic Auth 认证
- 灵活的连接池管理
- 详细的日志记录

---

## 2. 快速开始

### 2.1 下载安装
```bash
# 下载最新版本
wget https://github.com/gaoyuan98/dameng_exporter/releases/download/v1.2.0/dameng_exporter_v1.2.0_linux_amd64.tar.gz

# 解压
tar -xzvf dameng_exporter_v1.2.0_linux_amd64.tar.gz

# 赋予执行权限
chmod +x dameng_exporter
```

### 2.2 三种启动方式

#### 方式一：命令行参数（适合测试和单数据源）
```bash
# 必须同时指定三个参数
./dameng_exporter \
  --dbHost=192.168.1.100:5236 \
  --dbUser=SYSDBA \
  --dbPwd=SYSDBA123
```

#### 方式二：配置文件（推荐用于生产环境）
```bash
# 1. 创建配置文件 dameng_exporter.toml
# 2. 执行
./dameng_exporter
# 或指定配置文件
./dameng_exporter --configFile=/path/to/config.toml
```

#### 方式三：混合模式（命令行覆盖配置文件）
```bash
# 使用配置文件，但覆盖数据源
./dameng_exporter \
  --configFile=base.toml \
  --dbHost=test.db:5236 \
  --dbUser=TEST \
  --dbPwd=test123
```

### 2.3 验证运行
```bash
# 检查服务状态
curl http://localhost:9200/metrics | grep dm_up

# 查看版本信息
./dameng_exporter --help | head -1

# 查看实时日志
tail -f logs/dameng_exporter.log
```

---

## 3. 配置详解

### 3.1 配置优先级规则

```
优先级从高到低：
1. 命令行完整参数（--dbHost + --dbUser + --dbPwd）
2. 配置文件设置
3. 程序内置默认值
```

**重要规则：**
- 数据库连接参数必须**同时指定**或**都不指定**
- 只指定部分参数会报错退出
- 命令行参数指定后会**完全替换**配置文件的数据源

### 3.2 最小配置示例

#### 命令行最小配置
```bash
./dameng_exporter \
  --dbHost=localhost:5236 \
  --dbUser=SYSDBA \
  --dbPwd=SYSDBA
```

#### 配置文件最小配置
```toml
[[datasource]]
name = "default"
dbHost = "localhost:5236"
dbUser = "SYSDBA"
dbPwd = "SYSDBA"
```

### 3.3 完整配置示例

```toml
# =====================================
# 全局配置
# =====================================
listenAddress = ":9200"              # 监听地址和端口
metricPath = "/metrics"               # 指标暴露路径
version = "v1.2.0"                    # 版本信息（自动填充）

# 日志配置
logLevel = "info"                     # 日志级别：debug|info|warn|error
logMaxSize = 10                       # 单个日志文件最大大小（MB）
logMaxBackups = 3                     # 日志文件最大备份数
logMaxAge = 30                        # 日志文件最大保留天数

# 安全配置
encodeConfigPwd = false               # 启动时是否自动加密明文密码
enableBasicAuth = false               # 是否启用HTTP Basic认证
basicAuthUsername = ""                # Basic认证用户名
basicAuthPassword = ""                # Basic认证密码（支持ENC()加密格式）

# 性能配置
globalTimeoutSeconds = 5              # 全局采集超时时间（秒）
collectionMode = "blocking"          # 采集模式：blocking|fast

# =====================================
# 数据源配置（支持多个）
# =====================================
[[datasource]]
# 基础信息
name = "prod_master"                  # 数据源唯一标识（必需）
description = "生产环境主库"           # 数据源描述
enabled = true                        # 是否启用此数据源

# 连接配置
dbHost = "192.168.1.100:5236"        # 数据库地址:端口（必需）
dbUser = "SYSDBA"                     # 数据库用户名（必需）
dbPwd = "SYSDBA123"                   # 数据库密码（必需，支持ENC()加密）

# 连接池配置
queryTimeout = 10                    # 单个查询超时时间（秒）
maxOpenConns = 10                     # 最大打开连接数
maxIdleConns = 2                      # 最大空闲连接数
connMaxLifetime = 30                  # 连接最大生命周期（分钟）

# 缓存配置
bigKeyDataCacheTime = 60              # 大数据查询缓存时间（分钟）
alarmKeyCacheTime = 5                 # 告警数据缓存时间（分钟）

# 慢SQL监控
checkSlowSQL = false                  # 是否检查慢SQL
slowSqlTime = 10000                   # 慢SQL阈值（毫秒）
slowSqlMaxRows = 10                   # 返回慢SQL最大行数

# 指标注册
registerHostMetrics = false           # 是否注册主机指标
registerDatabaseMetrics = true        # 是否注册数据库指标
registerDmhsMetrics = false           # 是否注册DMHS指标
registerCustomMetrics = true          # 是否注册自定义指标
customMetricsFile = "./custom_queries.metrics"  # 自定义指标文件路径

# 其他配置
priority = 1                          # 优先级（用于负载均衡）
labels = "env=prod,dc=beijing"       # Prometheus标签（key=value格式）

# 第二个数据源示例
[[datasource]]
name = "prod_slave"
enabled = true
dbHost = "192.168.1.101:5236"
dbUser = "SYSDBA"
dbPwd = "ENC(zsvHz8TN9c/S2sXY3s/Y7svHz8TNm5iZhA==)"  # 加密密码
queryTimeout = 10
registerDatabaseMetrics = true
labels = "env=prod,role=slave"
```

### 3.4 密码加密

#### 生成加密密码
```bash
# 加密密码
./dameng_exporter --encryptPwd="YourPlainPassword"
# 输出：Encrypted Password: ENC(zsvHz8TN9c/S2sXY3s/Y7svHz8TNm5iZhA==)

# 加密Basic Auth密码
./dameng_exporter --encryptBasicAuthPwd="BasicAuthPassword"
```

#### 使用加密密码
```toml
# 在配置文件中使用
dbPwd = "ENC(zsvHz8TN9c/S2sXY3s/Y7svHz8TNm5iZhA==)"
basicAuthPassword = "ENC(xxxxx)"

# 或在命令行使用
./dameng_exporter \
  --dbHost=192.168.1.100:5236 \
  --dbUser=SYSDBA \
  --dbPwd="ENC(zsvHz8TN9c/S2sXY3s/Y7svHz8TNm5iZhA==)"
```

---

## 4. 最佳实践

### 4.1 环境配置建议

| 环境 | 配置方式 | 日志级别 | 连接数 | 缓存时间 | 慢SQL监控 |
|------|---------|---------|--------|----------|-----------|
| 开发 | 命令行 | debug | 5 | 5分钟 | 关闭 |
| 测试 | 配置文件 | info | 10 | 30分钟 | 开启 |
| 生产 | 配置文件 | warn | 20 | 60分钟 | 主库开启 |

### 4.2 生产环境配置模板

```toml
# production.toml
listenAddress = ":9200"
logLevel = "info"
logMaxSize = 100                      # 生产环境加大日志文件
logMaxBackups = 7                     # 保留一周
encodeConfigPwd = true                # 自动加密
enableBasicAuth = true                # 启用认证
basicAuthUsername = "prometheus"
basicAuthPassword = "ENC(xxxxx)"

[[datasource]]
name = "prod_primary"
dbHost = "primary.db.company.com:5236"
dbUser = "MONITOR"                    # 使用专用监控账号
dbPwd = "ENC(xxxxx)"
maxOpenConns = 20                     # 生产环境增加连接数
maxIdleConns = 5
queryTimeout = 10
bigKeyDataCacheTime = 60
checkSlowSQL = true                   # 主库监控慢SQL
slowSqlTime = 5000                    # 5秒为慢查询
registerDatabaseMetrics = true
registerHostMetrics = true            # 主库监控主机
labels = "env=prod,role=master,dc=beijing"

[[datasource]]
name = "prod_standby"
dbHost = "standby.db.company.com:5236"
dbUser = "MONITOR"
dbPwd = "ENC(xxxxx)"
maxOpenConns = 15
maxIdleConns = 3
queryTimeout = 10
bigKeyDataCacheTime = 120             # 备库延长缓存
checkSlowSQL = false                  # 备库不监控慢SQL
registerDatabaseMetrics = true
registerHostMetrics = false           # 备库不监控主机
labels = "env=prod,role=standby,dc=shanghai"
```

### 4.3 监控账号权限配置

```sql
-- 创建监控专用账号（最小权限原则）
CREATE USER MONITOR IDENTIFIED BY "Monitor@2025#Complex";

-- 授予必要的系统视图权限
GRANT SELECT ON V$INSTANCE TO MONITOR;
GRANT SELECT ON V$DATABASE TO MONITOR;
GRANT SELECT ON V$PARAMETER TO MONITOR;
GRANT SELECT ON V$DATAFILE TO MONITOR;
GRANT SELECT ON V$TABLESPACE TO MONITOR;
GRANT SELECT ON V$TEMPFILE TO MONITOR;
GRANT SELECT ON V$LOGFILE TO MONITOR;
GRANT SELECT ON V$ARCHIVED_LOG TO MONITOR;
GRANT SELECT ON V$SESSION TO MONITOR;
GRANT SELECT ON V$PROCESS TO MONITOR;
GRANT SELECT ON V$LOCK TO MONITOR;
GRANT SELECT ON V$TRANSACTION TO MONITOR;
GRANT SELECT ON V$SQL TO MONITOR;
GRANT SELECT ON V$SQLAREA TO MONITOR;
GRANT SELECT ON V$SQLTEXT TO MONITOR;
GRANT SELECT ON V$SYSTEM_EVENT TO MONITOR;
GRANT SELECT ON V$SESSION_EVENT TO MONITOR;
GRANT SELECT ON V$WAITSTAT TO MONITOR;
GRANT SELECT ON V$LATCH TO MONITOR;
GRANT SELECT ON V$SYSSTAT TO MONITOR;
GRANT SELECT ON V$SESSTAT TO MONITOR;
GRANT SELECT ON V$STATNAME TO MONITOR;
GRANT SELECT ON V$MEMORY_TARGET TO MONITOR;
GRANT SELECT ON V$SGA TO MONITOR;
GRANT SELECT ON V$SGAINFO TO MONITOR;
GRANT SELECT ON V$PGASTAT TO MONITOR;

-- 如需监控特定业务表（可选）
GRANT SELECT ON SCHEMA_NAME.TABLE_NAME TO MONITOR;

-- 如需监控备份信息（可选）
GRANT SELECT ON V$BACKUP TO MONITOR;
GRANT SELECT ON V$BACKUP_SET TO MONITOR;
```

### 4.4 容器化部署

#### Docker部署
```dockerfile
# Dockerfile
FROM alpine:3.18
RUN apk add --no-cache ca-certificates tzdata && \
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone
COPY dameng_exporter /usr/local/bin/
RUN chmod +x /usr/local/bin/dameng_exporter
EXPOSE 9200
USER nobody
ENTRYPOINT ["/usr/local/bin/dameng_exporter"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  dameng-exporter:
    image: dameng_exporter:v1.2.0
    container_name: dameng-exporter
    restart: unless-stopped
    ports:
      - "9200:9200"
    volumes:
      - ./config:/etc/dameng_exporter:ro
      - ./logs:/var/log/dameng_exporter
    environment:
      - TZ=Asia/Shanghai
    command:
      - --configFile=/etc/dameng_exporter/dameng_exporter.toml
    networks:
      - monitoring
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:9200/metrics"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  monitoring:
    external: true
```

#### Kubernetes部署
```yaml
# configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: dameng-exporter-config
  namespace: monitoring
data:
  dameng_exporter.toml: |
    listenAddress = ":9200"
    logLevel = "info"
    enableBasicAuth = true
    basicAuthUsername = "prometheus"
    basicAuthPassword = "ENC(xxxxx)"
    
    [[datasource]]
    name = "k8s_dameng"
    dbHost = "dameng-service.database.svc.cluster.local:5236"
    dbUser = "MONITOR"
    dbPwd = "ENC(xxxxx)"
    registerDatabaseMetrics = true
---
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dameng-exporter
  namespace: monitoring
  labels:
    app: dameng-exporter
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dameng-exporter
  template:
    metadata:
      labels:
        app: dameng-exporter
    spec:
      containers:
      - name: dameng-exporter
        image: dameng_exporter:v1.2.0
        imagePullPolicy: IfNotPresent
        ports:
        - name: metrics
          containerPort: 9200
          protocol: TCP
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /metrics
            port: metrics
          initialDelaySeconds: 30
          periodSeconds: 30
          timeoutSeconds: 10
        readinessProbe:
          httpGet:
            path: /metrics
            port: metrics
          initialDelaySeconds: 5
          periodSeconds: 10
          timeoutSeconds: 5
        volumeMounts:
        - name: config
          mountPath: /etc/dameng_exporter
          readOnly: true
        - name: logs
          mountPath: /var/log/dameng_exporter
        args:
        - --configFile=/etc/dameng_exporter/dameng_exporter.toml
      volumes:
      - name: config
        configMap:
          name: dameng-exporter-config
      - name: logs
        emptyDir: {}
---
# service.yaml
apiVersion: v1
kind: Service
metadata:
  name: dameng-exporter
  namespace: monitoring
  labels:
    app: dameng-exporter
spec:
  type: ClusterIP
  ports:
  - name: metrics
    port: 9200
    targetPort: metrics
    protocol: TCP
  selector:
    app: dameng-exporter
```

### 4.5 Prometheus集成

```yaml
# prometheus.yml
global:
  scrape_interval: 30s
  evaluation_interval: 30s
  external_labels:
    monitor: 'dameng-monitor'

scrape_configs:
  - job_name: 'dameng'
    scrape_interval: 30s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    basic_auth:
      username: 'prometheus'
      password: 'your_password'
    static_configs:
      - targets:
        - 'dameng-exporter-prod:9200'
        - 'dameng-exporter-test:9200'
    relabel_configs:
      # 从target中提取instance名称
      - source_labels: [__address__]
        target_label: __tmp_instance
        regex: '([^:]+)(?::\d+)?'
        replacement: '${1}'
      - source_labels: [__tmp_instance]
        target_label: instance
        regex: 'dameng-exporter-(.*)'
        replacement: '${1}'
```

### 4.6 告警规则配置

```yaml
# dameng_alerts.yml
groups:
  - name: dameng_database
    interval: 30s
    rules:
    # 数据库实例不可用
    - alert: DamengInstanceDown
      expr: up{job="dameng"} == 0
      for: 1m
      labels:
        severity: critical
        component: database
      annotations:
        summary: "达梦数据库实例不可用"
        description: "实例 {{ $labels.instance }} 已经超过1分钟无法访问"
        
    # 连接数过高
    - alert: DamengHighConnections
      expr: dm_connections_active / dm_connections_max > 0.8
      for: 5m
      labels:
        severity: warning
        component: database
      annotations:
        summary: "数据库连接数过高"
        description: "实例 {{ $labels.instance }} 连接数使用率超过80%，当前：{{ $value | humanizePercentage }}"
        
    # 慢查询过多
    - alert: DamengTooManySlowQueries
      expr: rate(dm_slow_queries_total[5m]) > 10
      for: 5m
      labels:
        severity: warning
        component: database
      annotations:
        summary: "慢查询过多"
        description: "实例 {{ $labels.instance }} 每分钟慢查询超过10个"
        
    # 表空间使用率过高
    - alert: DamengTablespaceUsageHigh
      expr: dm_tablespace_used_bytes / dm_tablespace_total_bytes > 0.9
      for: 10m
      labels:
        severity: warning
        component: database
      annotations:
        summary: "表空间使用率过高"
        description: "实例 {{ $labels.instance }} 表空间 {{ $labels.tablespace }} 使用率超过90%"
        
    # 归档空间不足
    - alert: DamengArchiveSpaceLow
      expr: dm_archive_space_free_bytes < 10737418240  # 10GB
      for: 5m
      labels:
        severity: critical
        component: database
      annotations:
        summary: "归档空间不足"
        description: "实例 {{ $labels.instance }} 归档空间剩余不足10GB"
```

---

## 5. 运维指南

### 5.1 日常运维

#### 启动与停止
```bash
# 前台运行（调试）
./dameng_exporter --configFile=dameng_exporter.toml

# 后台运行
nohup ./dameng_exporter --configFile=dameng_exporter.toml > /dev/null 2>&1 &

# 查看进程
ps -ef | grep dameng_exporter

# 停止服务
kill -TERM $(pidof dameng_exporter)
```

#### Systemd服务管理
```ini
# /etc/systemd/system/dameng_exporter.service
[Unit]
Description=Dameng Database Exporter
After=network.target

[Service]
Type=simple
User=prometheus
Group=prometheus
ExecStart=/usr/local/bin/dameng_exporter --configFile=/etc/dameng_exporter/dameng_exporter.toml
Restart=on-failure
RestartSec=5s
StandardOutput=journal
StandardError=journal
SyslogIdentifier=dameng_exporter

[Install]
WantedBy=multi-user.target
```

```bash
# 重新加载systemd配置
systemctl daemon-reload

# 启动服务
systemctl start dameng_exporter

# 停止服务
systemctl stop dameng_exporter

# 重启服务
systemctl restart dameng_exporter

# 查看服务状态
systemctl status dameng_exporter

# 设置开机自启
systemctl enable dameng_exporter

# 查看日志
journalctl -u dameng_exporter -f
```

### 5.2 日志管理

```bash
# 日志位置
logs/
├── dameng_exporter.log          # 当前日志
├── dameng_exporter-2025-09-02.log  # 归档日志
└── dameng_exporter-2025-09-01.log

# 查看错误日志
grep ERROR logs/dameng_exporter.log

# 查看警告日志
grep WARN logs/dameng_exporter.log

# 实时监控日志
tail -f logs/dameng_exporter.log

# 统计错误数量
grep -c ERROR logs/dameng_exporter.log

# 清理旧日志
find logs/ -name "*.log" -mtime +30 -delete
```

### 5.3 性能调优

#### 连接池调优参考

| 场景 | maxOpenConns | maxIdleConns | connMaxLifetime | queryTimeout |
|------|--------------|--------------|-----------------|--------------|
| 低负载（<100 QPS） | 5 | 1 | 60分钟 | 30秒 |
| 中负载（100-500 QPS） | 15 | 3 | 30分钟 | 20秒 |
| 高负载（>500 QPS） | 30 | 10 | 10分钟 | 10秒 |
| 网络不稳定 | 10 | 2 | 5分钟 | 15秒 |
| 数据仓库 | 10 | 2 | 30分钟 | 120秒 |

#### 缓存策略

```toml
# 静态数据多，变化少
bigKeyDataCacheTime = 180    # 3小时
alarmKeyCacheTime = 30       # 30分钟

# 实时性要求高
bigKeyDataCacheTime = 5      # 5分钟
alarmKeyCacheTime = 1        # 1分钟

# 平衡策略（推荐）
bigKeyDataCacheTime = 60     # 1小时
alarmKeyCacheTime = 5        # 5分钟
```

### 5.4 监控指标说明

主要指标类型：
- `dm_up`: 数据库是否可用（1=可用，0=不可用）
- `dm_connections_*`: 连接相关指标
- `dm_sessions_*`: 会话相关指标
- `dm_transactions_*`: 事务相关指标
- `dm_tablespace_*`: 表空间相关指标
- `dm_slow_queries_*`: 慢查询相关指标

---

## 6. 故障排查

### 6.1 常见问题

#### 问题1：数据库连接失败
```
ERROR: Failed to create pool for datasource: Error -2501: 用户名或密码错误
```
**解决方法：**
1. 检查数据库地址和端口是否正确
2. 验证用户名和密码
3. 确认数据库服务正常运行
4. 检查防火墙规则

#### 问题2：参数不完整错误
```
错误：数据库连接参数不完整！
必须同时指定：--dbHost、--dbUser、--dbPwd
```
**解决方法：**
必须同时指定所有三个参数，或者都不指定（使用配置文件）

#### 问题3：配置文件解析失败
```
Error loading TOML config file: failed to parse config file as TOML
```
**解决方法：**
1. 检查TOML语法是否正确
2. 确认引号、括号匹配
3. 使用在线TOML验证工具检查

#### 问题4：端口被占用
```
bind: address already in use
```
**解决方法：**
```bash
# 查看端口占用
netstat -tlnp | grep 9200
# 或
lsof -i:9200

# 修改配置使用其他端口
listenAddress = ":9201"
```

### 6.2 调试技巧

```bash
# 开启调试日志
./dameng_exporter --logLevel=debug

# 测试数据库连接
./dameng_exporter \
  --dbHost=test.db:5236 \
  --dbUser=TEST \
  --dbPwd=test \
  --logLevel=debug \
  --queryTimeout=10

# 验证配置文件
./dameng_exporter --configFile=test.toml --logLevel=debug

# 检查指标输出
curl -s http://localhost:9200/metrics | grep -E "^dm_"
```

### 6.3 性能问题排查

```bash
# 1. 检查连接池使用情况
curl -s http://localhost:9200/metrics | grep dm_connections

# 2. 查看慢查询
grep "slow query" logs/dameng_exporter.log

# 3. 监控内存使用
ps aux | grep dameng_exporter

# 4. 查看goroutine数量
curl http://localhost:9200/debug/pprof/goroutine?debug=1

# 5. CPU分析
go tool pprof http://localhost:9200/debug/pprof/profile
```

---

## 附录A：命令行参数完整列表

### 数据库连接参数
| 参数 | 类型 | 默认值 | 必需 | 说明 |
|------|------|--------|------|------|
| --dbHost | string | 无 | 与dbUser、dbPwd一起必需 | 数据库地址和端口，格式：host:port |
| --dbUser | string | 无 | 与dbHost、dbPwd一起必需 | 数据库用户名 |
| --dbPwd | string | 无 | 与dbHost、dbUser一起必需 | 数据库密码，支持明文和ENC()加密格式 |
| --dbName | string | cmdline_<host> | 否 | 数据源名称，未指定时自动生成 |

### 服务配置参数
| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| --configFile | string | ./dameng_exporter.toml | 配置文件路径 |
| --listenAddress | string | :9200 | 服务监听地址 |
| --metricPath | string | /metrics | 指标暴露路径 |

### 连接池参数
| 参数 | 类型 | 默认值 | 说明 |
|------|------|-----|------|
| --queryTimeout | int | 10  | 查询超时时间（秒） |
| --maxOpenConns | int | 10  | 最大打开连接数 |
| --maxIdleConns | int | 2   | 最大空闲连接数 |
| --connMaxLifetime | int | 30  | 连接最大生命周期（分钟） |

### 日志参数
| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| --logLevel | string | info | 日志级别：debug、info、warn、error |
| --logMaxSize | int | 10 | 单个日志文件最大大小（MB） |
| --logMaxBackups | int | 3 | 日志文件最大备份数 |
| --logMaxAge | int | 30 | 日志文件最大保留天数 |

### 功能开关参数
| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| --registerDatabaseMetrics | bool | true | 是否注册数据库指标 |
| --registerHostMetrics | bool | false | 是否注册主机指标 |
| --registerDmhsMetrics | bool | false | 是否注册DMHS指标 |
| --registerCustomMetrics | bool | true | 是否注册自定义指标 |
| --checkSlowSql | bool | false | 是否检查慢SQL |
| --slowSqlTime | int | 10000 | 慢SQL阈值（毫秒） |
| --slowSqlLimitRows | int | 10 | 返回慢SQL最大行数 |

### 缓存参数
| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| --bigKeyDataCacheTime | int | 60 | 大数据查询缓存时间（分钟） |
| --alarmKeyCacheTime | int | 5 | 告警数据缓存时间（分钟） |

### 安全参数
| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| --encodeConfigPwd | bool | false | 启动时是否自动加密配置文件中的明文密码 |
| --enableBasicAuth | bool | false | 是否启用HTTP Basic认证 |
| --basicAuthUsername | string | 空 | Basic认证用户名 |
| --basicAuthPassword | string | 空 | Basic认证密码 |
| --encryptPwd | string | 空 | 加密指定密码并退出 |
| --encryptBasicAuthPwd | string | 空 | 加密Basic Auth密码并退出 |

### 性能参数
| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| --globalTimeoutSeconds | int | 5 | 全局采集超时时间（秒） |
| --collectionMode | string | blocking | 采集模式：blocking（阻塞）、fast（快速） |

---

## 附录B：配置文件参数完整列表

### 全局配置参数
| 参数 | 类型 | 默认值 | 必需 | 说明 |
|------|------|--------|------|------|
| listenAddress | string | :9200 | 否 | 服务监听地址 |
| metricPath | string | /metrics | 否 | 指标暴露路径 |
| version | string | 自动填充 | 否 | 版本信息 |
| logLevel | string | info | 否 | 日志级别 |
| logMaxSize | int | 10 | 否 | 日志文件大小（MB） |
| logMaxBackups | int | 3 | 否 | 日志备份数 |
| logMaxAge | int | 30 | 否 | 日志保留天数 |
| encodeConfigPwd | bool | false | 否 | 自动加密密码 |
| enableBasicAuth | bool | false | 否 | 启用Basic认证 |
| basicAuthUsername | string | 空 | 否 | 认证用户名 |
| basicAuthPassword | string | 空 | 否 | 认证密码 |
| globalTimeoutSeconds | int | 5 | 否 | 全局超时（秒） |
| collectionMode | string | blocking | 否 | 采集模式 |

### 数据源配置参数
| 参数 | 类型 | 默认值                      | 必需 | 说明 |
|------|------|--------------------------|------|------|
| name | string | 无                        | 是 | 数据源唯一标识 |
| description | string | 空                        | 否 | 数据源描述 |
| enabled | bool | true                     | 否 | 是否启用 |
| dbHost | string | 无                        | 是 | 数据库地址:端口 |
| dbUser | string | 无                        | 是 | 数据库用户名 |
| dbPwd | string | 无                        | 是 | 数据库密码 |
| queryTimeout | int | 10                       | 否 | 查询超时（秒） |
| maxOpenConns | int | 10                       | 否 | 最大连接数 |
| maxIdleConns | int | 2                        | 否 | 最大空闲连接 |
| connMaxLifetime | int | 30                       | 否 | 连接生命周期（分钟） |
| bigKeyDataCacheTime | int | 60                       | 否 | 大数据缓存（分钟） |
| alarmKeyCacheTime | int | 5                        | 否 | 告警缓存（分钟） |
| checkSlowSQL | bool | false                    | 否 | 检查慢SQL |
| slowSqlTime | int | 10000                    | 否 | 慢SQL阈值（毫秒） |
| slowSqlMaxRows | int | 10                       | 否 | 慢SQL返回行数 |
| registerHostMetrics | bool | false                    | 否 | 注册主机指标 |
| registerDatabaseMetrics | bool | true                     | 否 | 注册数据库指标 |
| registerDmhsMetrics | bool | false                    | 否 | 注册DMHS指标 |
| registerCustomMetrics | bool | true                     | 否 | 注册自定义指标 |
| customMetricsFile | string | ./custom_queries.metrics | 否 | 自定义指标文件 |
| priority | int | 0                        | 否 | 优先级 |
| labels | string | 空                        | 否 | Prometheus标签 |

---

## 附录C：监控指标说明

### 基础指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_up | Gauge | 数据库是否可用（1=可用，0=不可用） | datasource |
| dm_uptime_seconds | Counter | 数据库运行时间（秒） | datasource |
| dm_version_info | Gauge | 数据库版本信息 | datasource, version |

### 连接指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_connections_max | Gauge | 最大允许连接数 | datasource |
| dm_connections_active | Gauge | 当前活动连接数 | datasource |
| dm_connections_idle | Gauge | 当前空闲连接数 | datasource |
| dm_connections_total | Counter | 总连接数 | datasource |
| dm_connections_failed_total | Counter | 失败的连接数 | datasource |

### 会话指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_sessions_active | Gauge | 活动会话数 | datasource |
| dm_sessions_inactive | Gauge | 非活动会话数 | datasource |
| dm_sessions_blocked | Gauge | 阻塞的会话数 | datasource |
| dm_sessions_killed_total | Counter | 被终止的会话总数 | datasource |

### 事务指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_transactions_total | Counter | 事务总数 | datasource |
| dm_transactions_commit_total | Counter | 提交的事务数 | datasource |
| dm_transactions_rollback_total | Counter | 回滚的事务数 | datasource |
| dm_transactions_active | Gauge | 当前活动事务数 | datasource |

### 表空间指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_tablespace_total_bytes | Gauge | 表空间总大小 | datasource, tablespace |
| dm_tablespace_used_bytes | Gauge | 表空间已用大小 | datasource, tablespace |
| dm_tablespace_free_bytes | Gauge | 表空间剩余大小 | datasource, tablespace |
| dm_tablespace_usage_percent | Gauge | 表空间使用率 | datasource, tablespace |

### 慢查询指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_slow_queries_total | Counter | 慢查询总数 | datasource |
| dm_slow_query_duration_seconds | Histogram | 慢查询执行时间分布 | datasource |
| dm_slow_query_rows_examined | Histogram | 慢查询扫描行数分布 | datasource |

### 性能指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_buffer_cache_hit_ratio | Gauge | 缓冲区命中率 | datasource |
| dm_library_cache_hit_ratio | Gauge | 库缓存命中率 | datasource |
| dm_disk_reads_total | Counter | 磁盘读取总数 | datasource |
| dm_disk_writes_total | Counter | 磁盘写入总数 | datasource |

### 锁指标

| 指标名称 | 类型 | 说明 | 标签 |
|---------|------|------|------|
| dm_locks_total | Gauge | 当前锁总数 | datasource |
| dm_locks_waiting | Gauge | 等待锁的数量 | datasource |
| dm_deadlocks_total | Counter | 死锁总数 | datasource |

### Counter 类型指标处理策略

#### 概述
Counter 类型是 Prometheus 中的累积计数器，只会递增不会递减（除非重启）。对于这类指标，我们采用统一的处理策略来计算每分钟的速率值。

#### 标准查询模式
```promql
rate(metric_name{filters}[$interval]) * 60
```

#### 实际示例
```promql
# SQL语句执行统计
rate(dmdbms_statement_type_total{
  statement_name="select statements",
  datasource=~"${datasource}",
  env=~"${env:.*}",
  region=~"${region:.*}",
  cluster=~"${cluster:.*}"
}[$interval]) * 60

# 检查点时间统计
rate(dmdbms_ckpttime_total{
  datasource=~"${datasource}",
  env=~"${env:.*}",
  region=~"${region:.*}",
  cluster=~"${cluster:.*}"
}[$interval]) * 60
```

#### 关键要素说明

1. **rate() 函数**
   - 自动计算指定时间窗口内的每秒增长率
   - 自动处理 Counter 重置（如服务重启）
   - 提供平滑的速率计算，避免瞬时尖峰

2. **$interval 变量**
   - 用户可选择的时间间隔（1m, 10m, 30m, 1h等）
   - 决定计算速率的时间窗口大小
   - 影响数据的聚合粒度和平滑程度

3. **乘以 60**
   - 将每秒速率转换为每分钟速率
   - 更符合业务理解（如：每分钟执行次数）
   - 统一所有速率指标的单位

#### 时间间隔的含义

| 间隔选择 | 计算窗口 | 效果说明 | 适用场景 |
|---------|---------|---------|---------|
| 1m | 1分钟 | 显示细粒度变化，波动较大 | 故障排查、实时监控 |
| 10m | 10分钟 | 中等平滑，显示中期趋势 | 日常监控、趋势分析 |
| 30m | 30分钟 | 较高平滑，过滤短期波动 | 业务分析、报表统计 |
| 1h | 1小时 | 高度平滑，显示长期趋势 | 容量规划、历史对比 |

#### 应用的 Counter 指标列表

1. **SQL执行统计类**
   - dmdbms_statement_type_total（各类SQL语句执行次数）
   - 包括：select, insert, update, delete, ddl statements
   - parse count, hard parse count, plan total count
   - plan cache hit count, logic read count
   - physical read count, physical write count
   - transaction total count

2. **缓存统计类**
   - dmdbms_dict_cache_total（字典缓存统计）
   - 包括：LRU淘汰次数、DDL淘汰次数

3. **系统统计类**
   - dmdbms_ckpttime_total（检查点时间统计）
   - 其他累积型系统指标

#### 优势说明

1. **自适应性**：根据用户选择的时间间隔动态调整
2. **准确性**：自动处理服务重启等异常情况
3. **一致性**：所有 Counter 类型指标采用统一处理方式
4. **可读性**：每分钟速率比每秒速率更直观

#### 注意事项

- 当采集间隔与查询间隔相同时（如都是1分钟），可能出现数据点不足
- 建议 Prometheus 采集间隔设置为30秒或更短
- 对于关键指标，可考虑设置最小时间间隔为2分钟

---

## 7. 高级功能

### 7.1 自定义指标配置

#### 创建自定义指标文件
```yaml
# custom_queries.metrics 示例
metrics:
  # 业务表行数监控
  - metric_name: business_table_rows
    type: gauge
    help: "业务表记录数统计"
    key_labels:
      - table_name
    values: [row_count]
    query: |
      SELECT 
        TABLE_NAME as table_name,
        NUM_ROWS as row_count
      FROM DBA_TABLES
      WHERE OWNER = 'BUSINESS_SCHEMA'
    
  # 自定义性能指标
  - metric_name: custom_performance_metric
    type: counter
    help: "自定义性能计数器"
    values: [value]
    query: |
      SELECT COUNT(*) as value 
      FROM V$SESSION 
      WHERE STATUS = 'ACTIVE'
      
  # 复杂业务指标
  - metric_name: business_transaction_stats
    type: histogram
    help: "业务事务统计"
    key_labels:
      - transaction_type
      - status
    value_label: duration
    values: [count, sum]
    query: |
      SELECT 
        TRANSACTION_TYPE as transaction_type,
        STATUS as status,
        COUNT(*) as count,
        SUM(DURATION_MS) as sum
      FROM BUSINESS_TRANSACTIONS
      WHERE CREATED_TIME > SYSDATE - 1/24
      GROUP BY TRANSACTION_TYPE, STATUS
```

#### 自定义指标类型说明

| 指标类型 | 说明 | 使用场景 |
|---------|------|----------|
| gauge | 可增可减的度量值 | 当前值统计（如：表大小、连接数） |
| counter | 只增不减的累计值 | 累计统计（如：事务总数、错误次数） |
| histogram | 分布统计 | 延迟、响应时间等分布情况 |
| summary | 分位数统计 | 百分位性能指标 |

### 7.2 多数据源负载均衡

#### 配置负载均衡策略
```toml
# 负载均衡配置
[[datasource]]
name = "primary_1"
priority = 10        # 高优先级
weight = 3          # 权重配置
maxConnections = 20

[[datasource]]
name = "primary_2"
priority = 10
weight = 2
maxConnections = 15

[[datasource]]
name = "standby_1"
priority = 5         # 低优先级（备用）
weight = 1
maxConnections = 10
```

#### 故障转移配置
```toml
# 全局故障转移设置
failoverEnabled = true
failoverRetryInterval = 30     # 重试间隔（秒）
failoverMaxRetries = 3         # 最大重试次数
healthCheckInterval = 60       # 健康检查间隔（秒）
```

### 7.3 性能优化技巧

#### 采集优化
```toml
# 分级采集策略
[[datasource]]
name = "optimized_ds"

# 高频指标（30秒采集一次）
highFrequencyMetrics = [
  "dm_connections_active",
  "dm_transactions_active",
  "dm_sessions_active"
]

# 中频指标（5分钟采集一次）
mediumFrequencyMetrics = [
  "dm_tablespace_usage",
  "dm_buffer_cache_hit_ratio"
]

# 低频指标（30分钟采集一次）
lowFrequencyMetrics = [
  "dm_database_size",
  "dm_backup_status"
]
```

#### 查询优化建议
1. **使用缓存**: 对于静态或慢变化数据启用缓存
2. **并行采集**: 启用`collectionMode = "fast"`实现并行采集
3. **索引优化**: 确保监控查询相关的系统视图有适当索引
4. **连接复用**: 合理配置连接池参数

### 7.4 插件扩展机制

#### 开发自定义采集器
```go
// custom_collector.go 示例
type CustomCollector struct {
    datasource *Datasource
}

func (c *CustomCollector) Describe(ch chan<- *prometheus.Desc) {
    // 描述指标
}

func (c *CustomCollector) Collect(ch chan<- prometheus.Metric) {
    // 采集逻辑
    query := "SELECT custom_metric FROM custom_table"
    // 执行查询并推送指标
}
```

#### 注册自定义采集器
```toml
# 配置文件中启用
[[datasource]]
name = "custom_enabled"
enableCustomCollector = true
customCollectorPath = "./plugins/custom_collector.so"
```

---

## 8. 监控集成

### 8.1 Grafana面板导入与配置

#### 导入预置面板
1. 下载面板文件：
   - `达梦DB监控面板_20250518.json` - 主监控面板
   - `DM全局告警表盘_20241212.json` - 告警面板

2. 导入步骤：
```bash
# 通过Grafana UI导入
1. 登录Grafana -> "+" -> Import
2. Upload JSON file -> 选择面板文件
3. 选择Prometheus数据源
4. 点击Import完成

# 或通过API导入
curl -X POST http://grafana:3000/api/dashboards/db \
  -H "Authorization: Bearer $API_KEY" \
  -H "Content-Type: application/json" \
  -d @达梦DB监控面板_20250518.json
```

#### 面板变量配置
```json
// Dashboard Variables
{
  "datasource": {
    "query": "label_values(dm_up, datasource)",
    "multi": true,
    "includeAll": true
  },
  "interval": {
    "options": ["1m", "5m", "10m", "30m", "1h"],
    "default": "5m"
  },
  "env": {
    "query": "label_values(dm_up, env)",
    "multi": true
  }
}
```

### 8.2 AlertManager配置

#### 告警路由策略
```yaml
# alertmanager.yml
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  
  routes:
  # 关键告警立即发送
  - match:
      severity: critical
    receiver: critical-receiver
    group_wait: 0s
    repeat_interval: 5m
    
  # 生产环境告警
  - match:
      env: production
    receiver: production-receiver
    continue: true
    
  # 静默测试环境夜间告警
  - match:
      env: test
    receiver: test-receiver
    mute_time_intervals:
      - night-silence

time_intervals:
  - name: night-silence
    time_intervals:
      - times:
        - start_time: '00:00'
          end_time: '06:00'
```

#### 告警模板定制
```go
// alertmanager-template.tmpl
{{ define "dameng.title" }}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.alertname }}
{{ end }}

{{ define "dameng.text" }}
{{ range .Alerts }}
*告警详情:*
{{ range .Labels.SortedPairs }}- {{ .Name }}: {{ .Value }}
{{ end }}
*描述:* {{ .Annotations.description }}
*开始时间:* {{ .StartsAt.Format "2006-01-02 15:04:05" }}
{{ if ne .Status "firing" }}*恢复时间:* {{ .EndsAt.Format "2006-01-02 15:04:05" }}{{ end }}
---
{{ end }}
{{ end }}
```

### 8.3 与其他监控系统集成

#### Zabbix集成
```bash
# 通过Zabbix外部脚本采集
#!/bin/bash
# dameng_metrics.sh
curl -s http://localhost:9200/metrics | \
  grep "^dm_" | \
  awk '{print $1, $2}' | \
  while read metric value; do
    zabbix_sender -z zabbix.server -s "dameng.host" -k "$metric" -o "$value"
  done
```

#### ELK集成
```yaml
# logstash配置
input {
  http_poller {
    urls => {
      dameng_metrics => "http://localhost:9200/metrics"
    }
    interval => 30
    codec => "plain"
  }
}

filter {
  grok {
    match => { 
      "message" => "^(?<metric_name>dm_[^{\s]+)(?:{(?<labels>[^}]+)})?\s+(?<value>[\d.]+)" 
    }
  }
  kv {
    source => "labels"
    field_split => ","
    value_split => "="
    trim_key => " "
    trim_value => '"'
  }
}

output {
  elasticsearch {
    hosts => ["localhost:9200"]
    index => "dameng-metrics-%{+YYYY.MM.dd}"
  }
}
```

---

## 9. 安全加固

### 9.1 访问控制

#### 网络隔离
```bash
# iptables规则示例
# 只允许Prometheus服务器访问
iptables -A INPUT -p tcp --dport 9200 -s prometheus.server.ip -j ACCEPT
iptables -A INPUT -p tcp --dport 9200 -j DROP

# 或使用firewalld
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="prometheus.server.ip" port port="9200" protocol="tcp" accept'
firewall-cmd --reload
```

#### 反向代理配置
```nginx
# nginx配置示例
server {
    listen 443 ssl;
    server_name dameng-exporter.example.com;
    
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    
    # IP白名单
    allow 10.0.0.0/8;
    allow 192.168.0.0/16;
    deny all;
    
    location /metrics {
        proxy_pass http://localhost:9200;
        proxy_set_header Host $host;
        
        # Basic认证
        auth_basic "Restricted";
        auth_basic_user_file /etc/nginx/.htpasswd;
        
        # 限流
        limit_req zone=metrics_limit burst=10;
    }
}
```

### 9.2 密码管理最佳实践

#### 使用密钥管理服务
```toml
# 集成HashiCorp Vault
[[datasource]]
name = "vault_integrated"
dbHost = "db.example.com:5236"
dbUser = "MONITOR"
# 从Vault获取密码
vaultEnabled = true
vaultAddr = "https://vault.example.com:8200"
vaultPath = "secret/data/dameng/monitor"
vaultKey = "password"
```

#### 定期轮换密码
```bash
#!/bin/bash
# rotate_password.sh
NEW_PWD=$(openssl rand -base64 32)

# 更新数据库密码
sqlplus -s SYSDBA/current_pwd@db <<EOF
ALTER USER MONITOR IDENTIFIED BY "$NEW_PWD";
EOF

# 加密新密码
ENCRYPTED_PWD=$(./dameng_exporter --encryptPwd="$NEW_PWD" | grep "Encrypted" | awk '{print $3}')

# 更新配置文件
sed -i "s/dbPwd = .*/dbPwd = \"$ENCRYPTED_PWD\"/" dameng_exporter.toml

# 重启服务
systemctl restart dameng_exporter
```

### 9.3 审计与合规

#### 审计日志配置
```toml
# 启用详细审计日志
logLevel = "debug"
auditEnabled = true
auditLogFile = "/var/log/dameng_exporter/audit.log"
auditLogMaxSize = 100
auditLogMaxBackups = 30
auditLogMaxAge = 90

# 记录的审计事件
auditEvents = [
  "authentication",
  "configuration_change",
  "metric_access",
  "error"
]
```

#### 合规性检查清单
- [ ] 所有密码已加密存储
- [ ] 启用HTTPS/TLS加密传输
- [ ] 配置访问控制和认证
- [ ] 最小权限原则（监控账号）
- [ ] 定期安全审计
- [ ] 日志保留满足合规要求
- [ ] 敏感数据脱敏处理

### 9.4 安全加固检查脚本

```bash
#!/bin/bash
# security_check.sh

echo "=== DAMENG_EXPORTER安全检查 ==="

# 检查配置文件权限
if [ $(stat -c %a dameng_exporter.toml) != "600" ]; then
    echo "[!] 配置文件权限不安全"
fi

# 检查是否有明文密码
if grep -q 'dbPwd = "[^E][^N][^C]' dameng_exporter.toml; then
    echo "[!] 检测到明文密码"
fi

# 检查是否启用认证
if ! grep -q 'enableBasicAuth = true' dameng_exporter.toml; then
    echo "[!] 未启用Basic认证"
fi

# 检查TLS配置
if ! grep -q 'enableTLS = true' dameng_exporter.toml; then
    echo "[!] 未启用TLS加密"
fi

# 检查监控账号权限
echo "[*] 请手动检查数据库监控账号权限是否符合最小权限原则"

echo "=== 检查完成 ==="
```

---

## 附录D：错误代码说明

### 数据库连接错误

| 错误代码 | 说明 | 解决方法 |
|---------|------|----------|
| -2501 | 用户名或密码错误 | 检查用户名和密码是否正确 |
| -2502 | 连接超时 | 检查网络连接，增加超时时间 |
| -2503 | 数据库未启动 | 确认数据库服务已启动 |
| -2504 | 监听地址错误 | 检查dbHost参数格式 |
| -2505 | 权限不足 | 检查用户权限 |

### 配置错误

| 错误信息 | 说明 | 解决方法 |
|---------|------|----------|
| Config file not found | 配置文件不存在 | 检查配置文件路径 |
| Failed to parse config file as TOML | TOML格式错误 | 检查TOML语法 |
| Duplicate datasource name | 数据源名称重复 | 确保name唯一 |
| Database connection parameters incomplete | 参数不完整 | 同时指定三个参数 |

### 运行时错误

| 错误类型 | 说明 | 解决方法 |
|---------|------|----------|
| bind: address already in use | 端口被占用 | 更换端口或停止占用进程 |
| connection pool exhausted | 连接池耗尽 | 增加maxOpenConns |
| query timeout | 查询超时 | 增加queryTimeout或优化查询 |
| permission denied | 权限不足 | 检查文件或目录权限 |

---

## 版本历史

### v1.2.0 (2025-09-03)
- 移除命令行参数默认值
- 支持多数据源监控
- 优化配置加载逻辑
- 增强密码加密功能

### v1.1.0 (2024-12-01)
- 添加慢SQL监控
- 支持Basic Auth认证
- 优化连接池管理

### v1.0.0 (2024-06-01)
- 初始版本发布
- 基础监控功能
- 支持配置文件和命令行参数

---

## 联系与支持

- GitHub: https://github.com/gaoyuan98/dameng_exporter
- Issues: https://github.com/gaoyuan98/dameng_exporter/issues
- 文档: https://github.com/gaoyuan98/dameng_exporter/wiki

---

**声明：** 本手册基于 v1.2.0 版本编写，后续版本可能有所变更，请以最新文档为准。